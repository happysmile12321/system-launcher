评价：**UI 的“骨架”已经搭建得非常出色，但核心功能的“血肉”尚未完全填充，并且存在一些关键的 Bug 和体验断点。**

作为产品经理，我将这些问题和您的新构想整合成一份高度聚焦的 V2.3 版本 PRD。本次迭代的核心任务是：**修复核心功能的断裂点，兑现已有设计承诺，并深化核心服务的集成，让平台真正“鲁棒”和“可用”。**

-----

## **产品需求文档 (PRD): Orchestrator Pro V2.3**

| 文档版本 | V2.3 |
| :--- | :--- |
| **主题** | **核心功能修复与深度集成** |
| **关联迭代日志** | [**点击查看 V2.3 实时开发进展 (迭代日志.md)**](https://www.google.com/search?q=./%E8%BF%AD%E4%BB%A3%E6%97%A5%E5%BF%97.md) |
| **创建日期** | 2025年9月20日 |

### 1\. 背景

V2.2 版本成功地将应用的 UI 提升到了一个全新的专业高度，并为组件、触发器和系统服务搭建了基本框架。然而，经过初步实现，我们发现：

1.  **组件工作区**的核心功能（编辑、测试）存在严重 Bug，未能达到可用状态。
2.  **系统服务**的集成逻辑（特别是容器和数据库）不够健壮，流程存在中断点。
3.  **触发器**虽然 Webhook 功能可用，但缺乏对周期性任务的支持，且长时任务处理机制缺失。

V2.3 版本的使命，就是集中火力解决这些最痛的点，**从“看起来能用”升级到“用起来可靠”**。

### 2\. V2.3 核心目标

  * **目标 1 (修复组件核心)**: 彻底修复组件工作区的编辑和测试功能，提供一流的开发体验，使其成为产品的核心优势。
  * **目标 2 (深化服务集成)**: 上线并夯实 `FeishuFS` 作为核心数据存储服务，并提升容器管理服务的健壮性。
  * **目标 3 (完善触发器)**: 补全周期性任务（Cron）触发器的功能，并为 Webhook 引入异步长任务处理机制。
  * **目标 4 (提升体验)**: 在不影响核心功能开发的前提下，解决一些高频操作的体验问题（如防抖、加载状态）。

### 3\. 功能需求 (Functional Requirements)

#### Epic 1: 组件工作区功能补全与修复 (优先级: P0)

  * **FR-1.1: 集成 Monaco Editor**
      * **痛点**: 自定义组件无法编辑，使用的是原生文本框而非专业编辑器。
      * **需求**: 必须将组件代码 (`index.js`) 和清单 (`component.json`) 的编辑区域，从 `<textarea>` **替换为 Monaco Editor**。编辑器需默认启用 JavaScript/JSON 语法高亮和基础的代码折叠功能。
  * **FR-1.2: 完善组件清单 (`component.json`) 的编辑与校验**
      * **痛点**: 组件清单无规范，导致创建的组件信息不全。
      * **需求**:
        1.  新建组件时，必须自动生成一个包含所有必填字段（`name`, `displayName`, `description`, `inputs`, `outputs`）的、带注释的 `component.json` 模板。
        2.  在组件编辑区，为 `component.json` 提供一个“**表单视图**”和“**源码视图**”的切换。表单视图可以引导用户以更友好的方式填写组件的输入输出参数。
  * **FR-1.3: 修复并上线“执行测试”功能**
      * **痛点**: 执行测试功能报错（`Unexpected token 'export'`），无法对组件进行快速验证。
      * **需求**:
        1.  **修复运行时 Bug**: 解决沙箱执行器对 ES Module (`export default`) 的兼容性问题。
        2.  **完善测试 UI**: 在“执行测试”标签页，UI 需根据 `component.json` 中定义的 `inputs`，**动态渲染出输入表单**。用户填写表单后点击“执行”，后端接收到结构化的输入数据并运行组件。
        3.  **输出面板**: 组件的返回值和 `Logger` 日志，必须清晰地展示在输出结果面板中。

#### Epic 2: 触发器系统增强 (优先级: P0)

  * **FR-2.1: 上线周期性任务 (Cron) 触发器**
      * **痛点**: 只有 Webhook 触发器，无法满足定时执行的需求。
      * **需求**: 在“工作流”-\>“触发器”配置部分，正式加入“**Cron 表达式**”选项。后端 `node-cron` 服务需能动态加载并执行这些定时任务。
  * **FR-2.2: Webhook 长时任务处理机制 (异步化)**
      * **痛点**: Webhook 请求的超时时间受限于 HTTP 协议，无法处理需要长时间运行的任务。
      * **需求**:
        1.  **架构改造**: Webhook 触发的逻辑必须改为**异步任务队列**模式。当 Webhook URL 被调用时，后端应立即将任务参数（请求体等）推入一个内部队列，并马上返回 `202 Accepted` 响应和一个唯一的 `jobId`。
        2.  **后台执行**: 一个独立的后台工作进程（Worker）负责从队列中拉取任务并执行。这解除了 HTTP 的超时限制，理论上任务可以运行任意长时间。
        3.  **状态查询**: （可选，V2.4 实现）提供一个 `GET /api/jobs/:jobId` 的接口，用于查询长时任务的执行状态。

#### Epic 3: 系统服务深度集成 (优先级: P1)

  * **FR-3.1: 健壮化容器管理服务**

      * **痛点**: 安装逻辑不够鲁棒，流程易中断。
      * **需求**: 优化安装流程的用户引导。当依赖检查失败时（如 Podman 未安装），**必须在 UI 上给出明确的、可复制的安装指导命令**，而不是简单的一句“未安装”。

  * **FR-3.2: 上线 `FeishuFS` (数据库管理)**

      * **痛点**: “数据库管理”功能未开发，其核心价值（利用飞书云盘）未体现。
      * **需求**:
        1.  **实现 Feishu OAuth 登录**: 在“设置”-\>“集成与服务”-\>“数据库管理”的安装流程中，核心步骤是引导用户完成飞书的 OAuth 2.0 授权流程，以获取操作用户云盘的权限。Token 需安全存储在本地配置文件中。
        2.  **实现 `FeishuFS` 模块**: 后端需新建一个 `FeishuFS` 服务，其 API 设计应与 `GitFS` 对齐（`readFile`, `writeFile`, `listDir` 等），封装所有飞书云盘的 API 调用。
        3.  **提供虚拟目录 UI**: 安装并登录后，“数据库管理”页面应转变为一个**虚拟文件浏览器**，展示应用在用户飞书云盘专属目录下的文件和文件夹。
        4.  **打通备份工作流**: 在“官方组件”中，新增一个“**Backup to Feishu Drive**”组件。该组件接收一个本地路径作为输入，将其打包压缩后，通过 `FeishuFS` 上传到飞书云盘。这使得“周期性备份容器数据”这一核心场景得以实现。

#### Epic 4: UI/UX 体验优化 (优先级: P2)

  * **FR-4.1: 添加加载骨架屏 (Skeleton Screens)**
      * **痛点**: 加载数据时，页面会短暂留白。
      * **需求**: 在加载工作流列表、组件列表、触发器列表等需要等待后端响应的区域，使用灰色的骨架屏作为占位符，提升加载体验的流畅度。
  * **FR-4.2: 关键按钮防抖 (Debouncing)**
      * **痛点**: “保存”、“执行”等按钮可被连续点击，可能引发多次重复的后端请求。
      * **需求**: 对所有会触发 API 请求的核心操作按钮，增加防抖或节流处理。

### 4\. 任务清单 (Actionable To-Do List)

#### 后端

  - [ ] **组件**: 替换 `<textarea>` 为 Monaco Editor 的后端支持。
  - [ ] **组件**: 修复 `isolated-vm` 执行器对 ES Module 的支持。
  - [ ] **组件**: 为“执行测试”功能提供一个接收结构化输入的 API 端点。
  - [ ] **触发器**: 实现 `node-cron` 的动态任务加载与管理。
  - [ ] **触发器**: 架构改造，引入内存或轻量级任务队列，实现 Webhook 的异步执行。
  - [ ] **FeishuFS**: 实现完整的飞书 OAuth 2.0 认证流程，安全存储和刷新 Token。
  - [ ] **FeishuFS**: 开发 `FeishuFS` 核心模块，封装飞书云盘文件操作 API。
  - [ ] **系统服务**: 完善容器服务安装流程的错误处理和引导。

#### 前端

  - [ ] **组件**: 在 UI 上集成 Monaco Editor。
  - [ ] **组件**: 开发 `component.json` 的表单视图编辑器。
  - [ ] **组件**: 开发“执行测试”标签页的动态输入表单和输出面板。
  - [ ] **触发器**: 在工作流设计器中增加 Cron 表达式的输入 UI。
  - [ ] **FeishuFS**: 开发飞书 OAuth 登录按钮和回调处理页面。
  - [ ] **FeishuFS**: 开发虚拟文件浏览器的 UI。
  - [ ] **UX**: 为主要数据列表区域添加骨架屏。
  - [ ] **UX**: 为核心按钮（保存、执行等）添加防抖逻辑。