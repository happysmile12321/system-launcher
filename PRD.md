好的，我完全理解。UI 的“骨架”已经非常出色和专业，现在是时候为它注入丰富、动态的“血肉”了。我们当前最迫切的任务，就是将那些“正在开发中”的占位符页面，替换为真正能与用户交互、能为用户创造价值的核心功能。

您提出的这几点精准地指出了我们下一步的战略方向：**激活组件生态、夯实触发器管理、并引入可插拔的系统级服务**。

遵照我们的新工作流，我为您撰写一份清晰、可执行的 V2.2 版本 PRD。

-----

## **产品需求文档 (PRD): Orchestrator Pro V2.2**

| 文档版本 | V2.2 |
| :--- | :--- |
| **主题** | **激活平台生态：组件、触发器与系统服务** |
| **关联迭代日志** | [**点击查看 V2.2 实时开发进展 (迭代日志.md)**](https://www.google.com/search?q=./%E8%BF%AD%E4%BB%A3%E6%97%A5%E5%BF%97.md) |
| **创建日期** | 2025年9月20日 |

### 1\. 背景

V2.1 版本成功构建了专业、美观的可视化工作流设计器 UI。目前，“工作流”页面的核心布局和静态展示已基本完成。然而，平台的另外三大核心板块——“组件”、“触发器”和“设置（系统服务）”——仍处于占位符状态。为了将 Orchestrator Pro 从一个“设计器”转变为一个真正可用的“自动化平台”，本次迭代的核心任务就是全面激活这些板块的功能。

### 2\. V2.2 核心目标

  * **目标 1 (激活组件)**: 正式上线组件工作区，支持系统内置组件的展示和用户自定义组件的在线创建与编辑，以此作为降低工作流编写难度的核心手段。
  * **目标 2 (激活触发器)**: 上线触发器管理面板，为用户提供一个中心化的界面来管理和监控所有工作流的入口（如 Webhooks）。
  * **目标 3 (引入系统服务)**: 引入“系统服务”这一全新概念，并上线第一个系统服务——“容器管理”，提供一个可按需安装和动态加载的扩展模块。

### 3\. 功能需求 (Functional Requirements)

#### Epic 1: 组件工作区 (The Component Workspace) (优先级: P0)

  * **FR-1.1: “组件”页面 UI 实现**
      * **需求**: 将当前的占位符页面替换为一个功能性的两栏工作区。
          * **左侧栏**: 组件列表，分为“**系统组件**”和“**我的组件**”两个可折叠的区域。
          * **右侧栏**: 内容展示区，用于查看或编辑选中的组件。
  * **FR-1.2: 系统组件 (Read-Only)**
      * **需求**: 系统组件由我们官方开发和维护，随应用打包发布。
      * **交互**: 用户在左侧列表点击一个系统组件，右侧内容区应以**只读模式**展示其 `index.js` (核心逻辑) 和 `component.json` (接口定义)。用户可以复制代码，但不能修改。
  * **FR-1.3: 用户自定义组件 (Editable)**
      * **需求**: 用户可以创建完全属于自己的组件，这些组件存储在用户 GitHub 仓库的 `.orchestrator-pro/components/` 目录下。
      * **创建流程**:
        1.  左侧列表“我的组件”区域旁提供一个“+ 新建”按钮。
        2.  点击后，弹窗要求输入组件 ID (如 `my-custom-sender`) 和显示名称。
        3.  确认后，系统会在 Git 仓库中自动创建对应的文件夹，并包含 `index.js` 和 `component.json` 的模板文件。
      * **编辑体验**:
        1.  点击一个“我的组件”，右侧内容区进入**编辑模式**。
        2.  编辑器提供两个标签页，分别用于编辑 `index.js` 和 `component.json`。
        3.  编辑器必须集成我们 V2.1 PRD 中设计的**智能提示和文档功能**。
        4.  提供“保存”按钮，点击后将修改提交到用户的 GitHub 仓库。

#### Epic 2: 触发器管理面板 (The Trigger Management Dashboard) (优先级: P0)

  * **FR-2.1: “触发器”页面 UI 实现**
      * **需求**: 将当前的占位符页面替换为一个功能性的触发器管理面板。
      * **功能**: 集中展示和管理所有通过工作流创建的“入口型”触发器，目前核心是 **Webhook**。
  * **FR-2.2: Webhook 列表与管理**
      * **交互**: 以列表形式展示所有已创建的 Webhook 触发器。每一项都应包含：
          * **Webhook URL**: 并提供一键复制功能。
          * **关联工作流**: 清晰地标明此 Webhook 触发的是哪个工作流。
          * **状态**: 启用/禁用开关。
  * **FR-2.3: Webhook 请求检查器 (Request Inspector)**
      * **需求**: 为每个 Webhook 提供一个“查看最近调用”的功能。
      * **交互**: 点击后，弹窗或进入新页面，展示最近的调用记录列表（时间、来源 IP、状态码）。点击任意一条记录，可以清晰地查看到完整的 **Request Headers** 和 **Request Body**，这对调试至关重要。

#### Epic 3: 系统服务与容器管理 (System Services & Container Management) (优先级: P1)

  * **FR-3.1: “系统服务”概念引入与按需安装**

      * **需求**: 引入一种可插拔的、官方维护的重量级功能模块，称为“系统服务”。这些服务默认不激活，用户可以按需安装。
      * **安装入口**: 在“**设置**”页面中，创建一个新的“**集成与服务**”区域。
      * **安装流程 (以容器管理为例)**:
        1.  该区域会列出可用的系统服务，如“**容器管理 (需要 Podman/Docker)**”，初始状态为“未安装”。
            2.旁边有一个“安装/激活”按钮。点击后，应用后端会执行一个内置的安装工作流：
              * **步骤 1**: 检查用户的环境中是否存在 `podman` 或 `docker` 命令。
              * **步骤 2**: 如果不存在，UI 提示用户“请先在您的服务器上安装 Podman 或 Docker”，并提供相关文档链接。
              * **步骤 3**: 如果存在，则将应用的本地配置文件 `.orchestrator.config.json` 中 `services.container_management.installed` 字段标记为 `true`，并提示“安装成功，请刷新页面”。

  * **FR-3.2: 动态加载的顶级导航**

      * **需求**: 当一个系统服务被成功安装后，应用的主导航栏中应**动态地出现一个新的顶级导航按钮**。
      * **交互**: 用户安装完“容器管理”并刷新页面后，在“工作流”、“组件”、“触发器”、“设置”的旁边，会出现一个新的“**容器管理**”按钮。

  * **FR-3.3: “容器管理”页面实现**

      * **需求**: “容器管理”页面是一个功能完善的面板，用于展示和操作本地容器。
      * **功能**:
          * **列表与状态**: 自动发现并以列表形式展示所有容器，包括状态（运行中/已停止）、端口映射等。
          * **快捷操作**: 为每个容器提供“启动”、“停止”、“重启”和“查看日志”的按钮。
          * **实时日志**: “查看日志”功能应能打开一个实时滚动显示容器日志的窗口。

#### Epic 4: 为组件设计可扩展 UI (前瞻性设计)

  * **FR-4.1: UI 文件约定**
      * **需求**: 探索允许用户自定义组件拥有自己简单控制 UI 的可能性。
      * **设计**: 规定一个文件约定：如果一个“用户组件”的文件夹内包含一个 `ui.html` 文件，那么系统就认为该组件拥有一个自定义 UI。
  * **FR-4.2: UI 渲染与交互 (技术预研)**
      * **渲染**: 在工作流或其他合适的视图中，可以提供一个按钮来“打开组件控制面板”，点击后在一个**沙箱化 `<iframe>`** 中渲染该 `ui.html`。
      * **通信**: 设计一个基于 `window.postMessage` 的安全通信桥梁，允许 `ui.html` 中的 JavaScript 调用预设的后端函数（例如，执行组件的某个特定方法）。
      * **目的**: 这不是 V2.2 的核心交付任务，但应在架构上为这种高阶扩展性预留接口和可能性。

-----

### 任务清单 (Actionable To-Do List)

#### 后端

  - [ ] **组件**: 实现用户组件的 CRUD API (`.orchestrator-pro/components/`)。
  - [ ] **组件**: 实现系统组件的只读 API (从应用包内读取)。
  - [ ] **触发器**: 实现 Webhook 的管理 API（创建、删除、列表）。
  - [ ] **触发器**: 实现 Webhook 调用历史的记录与查询 API。
  - [ ] **系统服务**: 实现“按需安装”的后台逻辑，能够检测依赖并修改本地配置。
  - [ ] **系统服务**: 实现 `ContainerService` (支持 Podman/Docker 驱动)，提供容器的列表、操作和日志流 API。
  - [ ] **架构**: 为未来的“组件自定义 UI”预留 `postMessage` 通信的后端接口。

#### 前端

  - [ ] **组件**: 开发“组件”页面的两栏式工作区 UI。
  - [ ] **组件**: 集成 Monaco Editor，并实现对 `index.js` 和 `component.json` 的编辑支持。
  - [ ] **触发器**: 开发“触发器”页面的 UI，包括列表和请求检查器。
  - [ ] **系统服务**: 开发“设置”页面中的“集成与服务”安装/激活面板。
  - [ ] **系统服务**: 开发动态加载顶级导航项的逻辑。
  - [ ] **系统服务**: 开发“容器管理”页面的完整 UI，包括列表、操作按钮和实时日志查看器。